function setStorage(){indexedDB||window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB;indexedDB?store.setDriver("IndexedDBWrapper").then(function(){console.log(store.driver+" IndexedDB")}):window.openDatabase?store.setDriver("WebSQLWrapper").then(function(){console.log(store.driver+" WebSQL")}):store.setDriver("localStorageWrapper").then(function(){console.log(store.driver+" LocalStorage")}),window.storeConfig={name:"visit_cheltenham_app",version:1,size:4980736,storeName:"vc_storage",description:"Config settings and other application data"}}function getSettings(){store.getItem("searchSettings").then(function(e){searchRadius=parseInt(e[0].searchRadius),"walking"==e[1].travelMode?travelMode=google.maps.TravelMode.WALKING:"bicycling"==e[1].travelMode?travelMode=google.maps.TravelMode.BICYCLING:"driving"==e[1].travelMode&&(travelMode=google.maps.TravelMode.DRIVING),"imperial"==e[2].unitSystem?unitSystem=google.maps.UnitSystem.IMPERIAL:"metric"==e[2].unitSystem&&(unitSystem=google.maps.UnitSystem.METRIC)}),store.getItem("userAccount").then(function(e){userName=e[0].userName,userEmail=e[1].userEmail,userPassword=e[2].userPassword})}function getID(){store.getItem("userAccount").then(function(e){name=e[0].userName}),$.ajax({type:"POST",data:{username:name},url:serverURL+"getuser.php",async:!1,success:function(e){userID=e},error:function(){console.log("Failed to get user id, probably there is no match for the given username in the database.")}}),console.log("User ID Function: "+userID)}function backButton(){console.log("backbutton"),navigator.notification.confirm("Exit?",function(e){1==e&&navigator.app.exitApp()},"Exit","Yes, No")}function reloadApp(){location.reload(!0)}var serverURL="http://www.martinsherwood.co.uk/visitcheltenham/",searchRadius,travelMode,unitSystem,userName,userEmail,userPassword,offerCount=0,name,userID,app={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1),document.addEventListener("backbutton",backButton,!1)},onDeviceReady:function(){setStorage(),getSettings()},report:function(e){console.log("report:"+e)}};$(function(){store.getItem("userAccount").then(function(e){name=e[0].userName}),$.ajax({type:"POST",data:{username:name},url:serverURL+"getuser.php",async:!1,success:function(e){userID=e},error:function(){console.log("Failed to get user id, probably there is no match for the given username in the database.")}}),console.log("User ID: "+userID)});var header='<header role="banner" data-role="header" class="app-header container inner-wrap"><div role="button" data-role="button" class="menu-stack push"></div><nav role="navigation" data-role="navbar" class="main-menu menu-closed"><div class="nav-links"><a data-goto="#search" data-push="page" data-get="settings" data-user="userid"><i class="fa fa-border fa-search"></i>Search</a><a data-goto="#favourites" data-push="page" data-get="favourites" data-user="userid"><i class="fa fa-border fa-star"></i>Favourites</a><a data-goto="#offers" data-push="page"><i class="fa fa-border fa-shopping-cart"></i>Offers<span id="offer-count"></span></a><a data-goto="#settings" data-push="page"><i class="fa fa-border fa-cog"></i>Settings</a></div></nav><div role="button" data-role="button" class="locate-button"></div></header>';$("body").prepend(header),$(function(){var e=$(".main-menu"),t=$("body"),a=$("#container"),n=$(".push"),o=$(".overlay"),s="menu-open",i="push-active",r="container-push",l="pushed",c=$(".menu-stack");app=$("#app"),handle="goto";var d=function(){t.toggleClass(i),e.toggleClass(s),a.toggleClass(r),n.toggleClass(l)};Modernizr.csstransforms3d&&(c.hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),d()}),o.hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),d()}),$("html").hammer().on("swipe",function(e){$(t).hasClass("push-active")||"right"!==e.gesture.direction?$(t).hasClass("push-active")&&"left"===e.gesture.direction&&(e.stopPropagation(),e.preventDefault(),d()):(e.stopPropagation(),e.preventDefault(),d())})),$currentPage=0===$("#app > .current").length?$("#offers").addClass("current"):$("#app > .current"),$('[data-push="page"]').hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),d();var t=$(app).find(".current"),a=$(this).data(handle);$(t).removeClass("current"),$(a).addClass("current")})}),function(){var e,t,a,n,o,s=$(".results-names"),i=$(".results-details"),r=$(".results h1"),l=new google.maps.LatLng(51.902707,-2.073361),c=[{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#a2daf2"}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{color:"#f7f1df"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#d0e3b4"}]},{featureType:"landscape.natural.terrain",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#bde6ab"}]},{featureType:"poi.medical",elementType:"geometry",stylers:[{color:"#fbd3da"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffe15f"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#efd151"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{color:"black"}]},{featureType:"transit.station.airport",elementType:"geometry.fill",stylers:[{color:"#cfb2db"}]}];getSettings(),$(function(){Modernizr.geolocation?GMaps.geolocate({success:function(e){var e={lat:e.coords.latitude,lng:e.coords.longitude};n=new google.maps.LatLng(e.lat,e.lng)},error:function(e){$(".location-map").append('<p class="no-geo message warning">Sorry, we failed to get your current location.</p>'),console.log(e.message)}}):noGeo()}),$(function(){function d(){Modernizr.geolocation?GMaps.geolocate({success:function(o){var o={lat:o.coords.latitude,lng:o.coords.longitude};n=new google.maps.LatLng(o.lat,o.lng),console.log("locate button, currentLocation: "+n),m(),t&&e&&(t.setMap(null),e.setMap(null)),a.addMarker({lat:o.lat,lng:o.lng,icon:"img/location-marker-blue.png",animation:google.maps.Animation.DROP}),a.setCenter(o.lat,o.lng),a.setZoom(16),$(".no-results").remove()},error:function(e){u(),console.log("Geolocation failed: "+e.message)}}):(p(),console.log("This browser/device does not support geolocation"))}function u(){$(".location-map").append('<p class="no-geo message warning">Sorry, this feature isn\'t available right now.</p>'),setTimeout(function(){$(".no-geo").remove()},3500)}function p(){$(".location-map").append('<p class="no-geo message warning">Sorry, this feature isn\'t supported on your device.</p>')}function m(){a.removeMarkers()}function f(){s.html(""),i.html(""),m(),$(".no-results").remove(),a.setZoom(14),t&&e&&(t.setMap(null),e.setMap(null))}return Modernizr.geolocation?(a=new GMaps({div:"#map-container",center:l,zoom:14,disableDefaultUI:!0,styles:c}),$(".locate-button").hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),Modernizr.geolocation?d():u()}),$('[data-action="submit-place-search"]').hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),$("#place-search").submit()}),$("#place-search").submit(function(c){c.stopPropagation(),c.preventDefault();var d=$("#place-query").val();return""==d?($("#place-query").focus(),$("#place-query").attr("placeholder","You didn't enter any terms")&&$("#place-query").addClass("plc-warning"),setTimeout(function(){$("#place-query").attr("placeholder","Search for places")&&$("#place-query").removeClass("plc-warning")},2800),!1):(a.addLayer("places",{location:l,radius:searchRadius,query:d,sensor:!0,language:"en-GB",textSearch:function(c,d){function u(e,t){if(t!=google.maps.DistanceMatrixStatus.OK)return!1;for(var a=e.originAddresses,n=e.destinationAddresses,o=0;o<a.length;o++)for(var s=e.rows[o].elements,r=0;r<s.length;r++){{var l=s[r],c=l.distance.text,d=l.duration.text;a[o],n[r]}i.append('<li data-animate="place-details" data-distance="'+c+'"data-duration="'+d+'">'+c+"</li>")}}if(d==google.maps.places.PlacesServiceStatus.OK){f();for(var p=new google.maps.LatLngBounds,m=0;m<c.length;m++){var g=c[m],h={url:g.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(20,20)};s.append('<li data-animate="place-name" data-placename="'+g.name+'"><span class="placename">'+g.name+'</span><div class="options"><div class="opt"><div data-destination="'+g.formatted_address+'" id="get-directions" class="directions-button"></div></div><div class="opt"><div data-placename="'+g.name+'" data-address="'+g.formatted_address+'" id="add-favourite" class="add-favourite-button"></div></div></div></li>'),o=n;var v=g.geometry.location,$=new google.maps.DistanceMatrixService;$.getDistanceMatrix({origins:[o],destinations:[v],travelMode:travelMode,unitSystem:unitSystem,avoidHighways:!1,avoidTolls:!1},u),a.addMarker({lat:g.geometry.location.lat(),lng:g.geometry.location.lng(),icon:h,animation:google.maps.Animation.DROP,title:g.name,infoWindow:{content:'<h2 class="iw-heading">'+g.name+'</h2><p class="iw-address">'+(g.vicinity?g.vicinity:g.formatted_address)+"</p>"}}),p.extend(g.geometry.location)}a.fitBounds(p),e=a.drawCircle({center:l,radius:4,strokeColor:"#00adef",strokeOpacity:1,strokeWeight:8,fillColor:"#00adef",fillOpacity:1}),t=a.drawCircle({center:l,radius:searchRadius,strokeColor:"#00adef",strokeOpacity:1,strokeWeight:1,fillColor:"#808080",fillOpacity:.28})}else d==google.maps.places.PlacesServiceStatus.ZERO_RESULTS?(console.log(d),f(),r.after('<p class="warning no-results">Sorry, no places were found matching your search.</p>')):d==google.maps.places.PlacesServiceStatus.INVALID_REQUEST&&console.log(d)}}),i.hammer().on("tap","li",function(e){e.stopPropagation(),e.preventDefault();var t=$(this),a=$(this).data("distance"),n=$(this).data("duration");t.text()==a?t.text(n):t.text(a)}),google.maps.event.addListener(a,"bounds_changed",function(){var e=a.getBounds();$("#place-query").setBounds(e)}),void 0)}),void 0):(p(),!1)}),$(function(){var e,t,a,o='<div id="directions-box" class="modal-window"><h1 class="inner-wrap" data-transition="slide-down-in">Directions<div id="close-directions" class="close-modal"></div></h1><div id="directions-list"></div></div>';$(".results-names").hammer().on("swipeleft tap","li",function(e){e.stopPropagation(),e.preventDefault(),$(this).children("span").toggleClass("swiped"),$(this).children("div").toggleClass("shown")}),$(".results-names").hammer().on("tap","#add-favourite",function(a){a.stopPropagation(),a.preventDefault(),e=$(this).data("placename"),t=$(this).data("address"),$.ajax({context:this,type:"POST",data:{userid:userID,placename:e,placeaddress:t},url:serverURL+"addfavourite.php",beforeSend:function(){console.log("adding to favourites")},success:function(){$(this).attr("id","remove-favourite"),$(this).addClass("remove-favourite-button"),console.log("added "+e+" to favourites")},error:function(){console.log("error: "+this)}})}),$(".results-names").hammer().on("tap","#remove-favourite",function(t){t.stopPropagation(),t.preventDefault(),e=$(this).data("placename"),$.ajax({context:this,type:"POST",data:{userid:userID,placename:e},url:serverURL+"removefavourite.php",beforeSend:function(){console.log("deleting from favourites")},success:function(){$(this).attr("id","add-favourite"),$(this).removeClass("remove-favourite-button"),console.log("deleted "+e+" from favourites")},error:function(){console.log("There was a problem processing your request.")}})}),$(".results-names").hammer().on("tap","#get-directions",function(e){e.stopPropagation(),e.preventDefault(),$("#home").removeClass("current"),$("body").prepend(o),a=$(this).data("destination");var t=document.getElementById("directions-list"),s=new google.maps.DirectionsService,i=new google.maps.DirectionsRenderer;i.setPanel(t),s.route({origin:n,destination:a,travelMode:travelMode,unitSystem:unitSystem},function(e,t){t===google.maps.DirectionsStatus.OK&&i.setDirections(e)}),$("#close-directions").hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),$("#directions-box").remove(),$("#home").addClass("current")})})})}(),$(function(){function e(){$.ajax({type:"POST",data:{userid:userID},url:serverURL+"getfavourites.php",async:!0,beforeSend:function(){n.append('<p class="message getting">Getting your favourites...<br><i class="fa fa-2x fa-spinner fa-spin"></i></p>')},success:function(e){$(".getting").remove(),objects=JSON.parse(e),$.each(objects,function(e,t){n.append('<li class="entry" data-animate="favourite" data-place="'+t+'"><span class="place-count">'+o+'</span><span class="place">'+t+'</span><div class="more"><div class="p-action"><div data-place="'+t+'" id="comment-place" class="comment-place-button"></div></div><div class="p-action"><div data-place="'+t+'" id="share-place" class="share-place-button"></div></div><div class="p-action"><div data-place="'+t+'" id="delete-favourite" class="delete-place-button"></div></div></div></li>'),o++}),$("#refresh-favourites").removeClass("fa-spin")},error:function(){console.log("oh no")}})}function t(){n.html(""),o=1}{var a,n=$(".favourites-list"),o=1,s='<div id="comments-box" class="modal-window"><h1 class="inner-wrap" data-transition="slide-down-in">Comments<div id="close-comments" class="close-modal"></div></h1><div class="add-comment"><form id="place-comment" method="post"><textarea id="comment" name="comment" placeholder="Enter a comment" autocorrect="on" autocapitalize="on" maxlength="180"></textarea><div id="post-comment" class="comments-button inner-wrap">Post Comment<div class="submit-icon"></div></div></form></div><div id="comments-list" class="inner-wrap"></div></div>';$("#comments-list")}$("#refresh-favourites").hammer().on("tap",function(a){a.stopPropagation(),a.preventDefault(),$(this).addClass("fa-spin"),console.log("refreshing"),t(),e()}),n.hammer().on("swipeleft tap","li",function(e){e.stopPropagation(),e.preventDefault(),$(this).children("span").toggleClass("swiped"),$(this).children("div").toggleClass("shown")}),n.hammer().on("tap","#comment-place",function(e){e.stopPropagation(),e.preventDefault(),$(".comment-error").remove(),a=$(this).data("place"),$("#favourites").removeClass("current"),$("body").prepend(s),$.ajax({type:"POST",data:{placename:a},url:serverURL+"getcomments.php",async:!0,beforeSend:function(){$("#comments-list").append('<p class="message getting">Getting comments...<br><i class="fa fa-2x fa-spinner fa-spin"></i></p>')},success:function(e){$(".getting").remove(),objects=JSON.parse(e),$.each(objects,function(e,t){$("#comments-list").append('<div data-animate="comment" class="comment"><span class="by">'+t.username+'<span class="on">'+t.date+"</span></span><p>"+t.comment+"</p></div>")})},error:function(){$(".getting").remove(),$("#comments-list").append('<p class="warning comment-error">Sorry, there was an error getting the comments.</p>')}}),$("#comment").focus(function(){$("#comments-list").addClass("making-comment"),$("#comment").blur(function(){$("#comments-list").removeClass("making-comment")})}),$("#post-comment").hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),$("#place-comment").submit()}),$("#place-comment").submit(function(e){e.stopPropagation(),e.preventDefault();var t=$("#comment").val();return""==t?($("#comment").focus(),$("#comment").attr("placeholder","You didn't enter a comment")&&$("#comment").addClass("plc-warning"),setTimeout(function(){$("#comment").attr("placeholder","Enter a comment")&&$("#comment").removeClass("plc-warning")},2800),!1):($(".comment-error").remove(),$.ajax({context:this,type:"POST",data:{userid:userID,username:userName,placename:a,comment:t},url:serverURL+"comment.php",async:!0,beforeSend:function(){$("#place-comment").append('<p class="message success prominent posting">Posting comment...<br><i class="fa fa-2x fa-spinner fa-spin"></i></p>')},success:function(){$(".posting").remove(),$("#place-comment").append('<p class="message success prominent timed">Your comment has been posted.</p>'),setTimeout(function(){$(".timed").remove(),$("#comments-list").prepend('<div data-animate="comment" class="comment"><p><span class="by">'+userName+"</span>"+t+"</p></div>"),$("#comment").val("")},3500)},error:function(){$("#place-comment").append('<p class="warning comment-error">Sorry, there was an error getting the comments.</p>')}}),void 0)}),$("#comments-list").hammer().on("tap",".comment",function(e){e.stopPropagation(),e.preventDefault(),$("p",this).toggleClass("expanded")}),$("#close-comments").hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),$("#comments-box").remove(),$("#favourites").addClass("current")})}),n.hammer().on("tap","#share-place",function(e){e.stopPropagation(),e.preventDefault(),a=$(this).data("place"),window.location.href="mailto:?subject=Check this place out!&body=Hey, I found this really good place called, "+a+"."}),n.hammer().on("tap","#delete-favourite",function(e){e.stopPropagation(),e.preventDefault(),a=$(this).data("place"),$.ajax({context:this,type:"POST",data:{userid:userID,placename:a},url:serverURL+"removefavourite.php",beforeSend:function(){console.log("deleting from favourites")},success:function(){$(this).parents("div div li.entry").remove(),console.log("deleted "+a+" from favourites")}})}),$('[data-get="favourites"]').hammer().on("tap",function(a){a.stopPropagation(),a.preventDefault(),t(),e()})}),$(function(){function e(){return $.ajax({url:serverURL+"getoffers.php",async:!0,beforeSend:function(){console.log("getting offers"),$(".offer-roll").append('<p class="message getting">Getting offers...<br><i class="fa fa-2x fa-spinner fa-spin"></i></p>')},success:function(){$(".getting").remove()},error:function(){$("#place-comment").append('<p class="warning comment-error">Sorry, there was an error getting the comments.</p>'),console.log("failed to get offers")}})}function t(e){objects=JSON.parse(e),$.each(objects,function(e,t){offerCount++,offerCount>99?offerCount=99:(0>offerCount||0==offerCount)&&(offerCount=0),console.log(t)}),$("#offer-count").html(offerCount)}e().done(t),function(e,t,a,n){var o;o=function(){function t(t,a){this.elem=t,this.$elem=e(t),this.options=a,this.metadata=this.$elem.data("plugin-options")}return t}(),o.prototype={defaults:{width:800,height:530,autoSize:!0,touchNav:!0,mouseNav:!0,prevnextNav:!0,prevnextAutoHide:!0,pagerNav:!0,startSlide:1,autoPlay:!0,delay:0,interval:3e3,repeat:!0,playReverse:!1,hoverPause:!0,captionAutoHide:!1,animationCssTransitions:!0,animationDuration:500,animationTimingFunction:"linear",prevButtonClass:"slide-prev",nextButtonClass:"slide-next",prevButtonImage:"Images/prev.png",nextButtonImage:"Images/next.png",activeSlideClass:"es-active",slideCaptionClass:"es-caption",pagerClass:"es-pager",pagerImage:"Images/pagericon.png"},init:function(){var a,o,s,i,r,l,c,d,u,p;return a=this,a.config=e.extend({},a.defaults,a.options,a.metadata),a.data=e.data(a),e.data(a,"currentSlide",a.config.playReverse&&1==a.config.startSlide?a.$elem.children().length-1:a.config.startSlide-1),e.data(a,"nextSlide",a.data.currentSlide),e.data(a,"totalslides",a.$elem.children().length),e.data(a,"browserEnginePrefix",a._getBrowserEnginePrefix()),e.data(a,"isPlaying",!1),e.data(a,"isAnimating",!1),e.data(a,"playPaused",!1),e.data(a,"justTouched",!1),e.data(a,"isMoving",!1),e.data(a,"width",a.config.width),a.$elem.addClass("slider"),a.$elem.css({position:"relative"}),a.$elem.wrapInner("<div class='slide-wrapper'>",a.$elem).children(),a.$elem.wrapInner("<div class='slide-container'>",e(".slide-wrapper",a.$elem)).children(),a.$elem.wrapInner("<div class='slide-dragcontainer'>",e(".slide-container",a.$elem)).children(),e(".slide-container",a.$elem).css({position:"relative"}),p=e(".slide-dragcontainer",a.$elem),d=e(".slide-wrapper",a.$elem),u=d.children(),a.config.prevnextNav&&(d.after("<div class='"+a.config.nextButtonClass+"'>"),d.after("<div class='"+a.config.prevButtonClass+"'>"),i=e("."+a.config.nextButtonClass,a.$elem),s=e("."+a.config.prevButtonClass,a.$elem),i.append("<img src='"+a.config.nextButtonImage+"'>"),s.append("<img src='"+a.config.prevButtonImage+"'>"),r=i.add(s),a.config.prevnextAutoHide&&(r.hide(),a.$elem.hover(function(){r.fadeIn("fast")},function(){r.fadeOut("fast")})),s.on("click",function(){a.previous()}),i.on("click",function(){a.next()})),a.config.pagerNav&&(a.$elem.append("<ul class='"+a.config.pagerClass+"'>"),u.each(function(){e("<li />").appendTo(e("."+a.config.pagerClass,a.$elem)).attr("rel",e(this).index()).css({"background-image":"url('"+a.config.pagerImage+"')"}).on("click",function(){e.data(a,"nextSlide",parseInt(e(this).attr("rel"))),a._prepareslides(!0),a._slide(!0),a._manualInterference()})})),u.each(function(){l=e(this),c=l.data("plugin-slide-caption"),c!==n&&("IMG"==this.tagName?(l.wrap("<div>"),l.after("<div class='"+a.config.slideCaptionClass+"'>"),l.next().append(c)):(l.append("<div class='"+a.config.slideCaptionClass+"'>"),l.children().last().append(c)),a.config.captionAutoHide&&(e("."+a.config.slideCaptionClass,a.$elem).hide(),a.$elem.hover(function(){e("."+a.config.slideCaptionClass,a.$elem).fadeIn("fast")},function(){e("."+a.config.slideCaptionClass,a.$elem).fadeOut("fast")})))}),d.children().addClass("slide").css({position:"absolute",top:0,left:0,width:a.data.width,height:a.config.height,zIndex:0,display:"none",webkitBackfaceVisibility:"hidden"}),o=u.height(),d.css({position:"relative",left:0,height:o}),e(".slide-container",a.$elem).css({width:a.data.width,overflow:"hidden",height:o}),a.config.touchNav&&(p.on("touchstart",function(e){var t=e.originalEvent.touches[0];return e.preventDefault(),a._onMoveStart(t.pageX,t.pageY),e.stopPropagation()}),p.on("touchmove",function(e){var t=e.originalEvent.touches[0];return e.preventDefault(),a._onMove(t.pageX,t.pageY),e.stopPropagation()}),p.on("touchend",function(e){return e.preventDefault(),a._onMoveEnd(),e.stopPropagation()})),a.config.mouseNav&&(p.css("cursor","pointer"),p.on("dragstart",function(){return!1}),p.on("mousedown",function(n){return a._onMoveStart(n.clientX,n.clientY),e(t).attr("unselectable","on").on("selectstart",!1).css("user-select","none").css("UserSelect","none").css("MozUserSelect","none"),n.stopPropagation()}),e(t).on("mousemove",function(e){return a._onMove(e.clientX,e.clientY),e.stopPropagation()}),e(t).on("mouseup",function(n){return a._onMoveEnd(),e(t).removeAttr("unselectable").unbind("selectstart").css("user-select",null).css("UserSelect",null).css("MozUserSelect",null),n.stopPropagation()})),a.config.autoSize&&(setTimeout(function(){a._resize()},50),e(t).resize(function(){return setTimeout(function(){a._resize()},50)})),a._prepareslides(),a.gotoSlide(a.data.currentSlide),a.config.autoPlay&&setTimeout(function(){a.start()},a.config.delay),this},previous:function(){var t,a;return t=this,e.data(t,"slideDirection","previous"),a=(t.data.nextSlide-1)%t.data.totalslides,!t.config.repeat&&t.data.nextSlide-1<0?(t.config.playReverse&&(e.data(t,"playPaused",!0),t.stop()),void 0):(t.data.playPaused&&t.data.nextSlide-1>0&&(e.data(t,"playPaused",!1),t.start()),e.data(t,"nextSlide",a),this._slide())},next:function(){var t,a;return t=this,e.data(t,"slideDirection","next"),a=(t.data.nextSlide+1)%t.data.totalslides,!t.config.repeat&&t.data.nextSlide+1>t.data.totalslides-1?(t.config.playReverse||(e.data(t,"playPaused",!0),t.stop()),void 0):(t.data.playPaused&&t.data.nextSlide+1<t.data.totalslides-1&&(e.data(t,"playPaused",!1),t.start()),e.data(t,"nextSlide",a),this._slide())},start:function(){var t,a,n;t=this,a=e(".slide-container",t.$elem),t.data.isPlaying&&t.data.playTimer&&clearInterval(t.data.playTimer),n=setInterval(function(){t.config.playReverse?t.previous():t.next()},t.config.interval),e.data(t,"playTimer",n),t.config.hoverPause&&(a.unbind(),a.hover(function(){return e.data(t,"playPaused",!0),t.stop()},function(){return e.data(t,"playPaused",!1),t.start()})),e.data(t,"isPlaying",!0)},stop:function(){var t,a;t=this,a=e(".slide-container",t.$elem),clearInterval(t.data.playTimer),e.data(t,"playTimer",null),t.config.hoverPause&&!t.data.playPaused&&a.unbind(),e.data(t,"isPlaying",!1)},gotoSlide:function(t){var a,n,o,s,i,r;a=this,e.data(a,"nextSlide",t%a.data.totalslides),n=t%a.data.totalslides,e.data(a,"currentSlide",n),o=e(".slide-wrapper",a.$elem),s=o.children(),i=o.children(":eq("+n+")"),r=i.position().left,a._setActive(s,i),a.config.animationCssTransitions&&a.data.browserEnginePrefix?a._transition(-r,0):o.position().left=-r,a._alignSlides(r)},_manualInterference:function(){var e=this;e.data.isPlaying&&(e.stop(),e.start())},_prepareslides:function(t){var a,n,o,s,i,r;a=this,n=e(".slide-wrapper",a.$elem),o=n.children(),s=a.data.width,i=Math.floor(a.data.totalslides/2),r=0,o.each(function(){e(this).css({display:"block",left:s*r,zIndex:10}),r++,!t&&a.config.repeat&&r>i&&(r=a.data.totalslides%2?-i:-(i-1))})},_onMoveStart:function(t,a){var n=this;n.data.isMoving||e.data(n,"touchTime",Number(new Date)),e.data(n,"touchedX",t),e.data(n,"touchedY",a),e.data(n,"isMoving",!0),n.data.isPlaying&&(e.data(n,"playPaused",!0),n.stop())},_onMove:function(t,a){var n,o,s,i,r,l,c;n=this,n.data.isMoving&&(o=e(".slide-wrapper",n.$elem),e.data(n,"scrolling",Math.abs(t-n.data.touchedX)<Math.abs(a-n.data.touchedY)),n.data.scrolling||n.data.isAnimating||(s=o.children(":eq("+n.data.nextSlide+")"),i=s.position().left,r=n.data.browserEnginePrefix.css,l=t-n.data.touchedX,c=.1*n.data.width,n.config.repeat||(n.data.currentSlide<=0&&-c>-l?l=c:n.data.currentSlide>=n.data.totalslides-1&&-l>c&&(l=-c)),n._transition(-i+l,0)))},_onMoveEnd:function(){var t,a,n,o,s,i,r;t=this,t.data.isMoving&&(a=e(".slide-wrapper",t.$elem),e.data(t,"justTouched",!0),n=a.children(":eq("+t.data.nextSlide+")"),o=n.position().left,s=.5*t.data.width,i=.1*t.data.width,r=Number(new Date)-t.data.touchTime<250,!t.config.repeat&&(a.position().left<-o&&t.data.currentSlide>=t.data.totalslides-1||a.position().left>-o&&t.data.currentSlide<=0)?t._transition(-o,.15):a.position().left>-o+s||a.position().left>-o+i&&r?this.previous():a.position().left<-(o+s)||a.position().left<-(o+i)&&r?this.next():t._transition(-o,.15),t._alignSlides(o),e.data(t,"isMoving",!1),e.data(t,"justTouched",!1),t.data.playPaused&&t.start())},_alignSlides:function(t){var a,o,s,i,r,l,c,d,u,p,m;if(a=this,a.config.repeat)for(o=e(".slide-wrapper",a.$elem),s=o.children(),t===n&&(i=o.children(":eq("+a.data.nextSlide+")"),t=i.position().left),t=Math.round(t,0),r=Math.ceil(a.data.totalslides/2),l=a.data.width,c=0,s.each(function(){var a=e(this).position().left;a>t-l&&c++}),d=r-c,0>d&&(d=a.data.totalslides%2==0?d+1:d),u=0;u<Math.abs(d);u++)p=[].reduce.call(s,function(t,a){return e(t).offset().left<e(a).offset().left?t:a}),m=[].reduce.call(s,function(t,a){return e(t).offset().left>e(a).offset().left?t:a}),d>0?e(p).css("left",Math.round(e(m).position().left+l)):e(m).css("left",Math.round(e(p).position().left-l))},_slide:function(t){var a,n,o,s,i,r;a=this,n=a.data.nextSlide,o=e(".slide-wrapper",a.$elem),s=o.children(),i=o.children(":eq("+n+")"),r=Math.round(i.position().left),a._setActive(s,i),t||a._alignSlides(r),e.data(a,"isAnimating",!0),a.config.animationCssTransitions&&a.data.browserEnginePrefix?(a._transition(-r,a.data.justTouched?.5:1),o.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",function(){e.data(a,"currentSlide",n),o.unbind("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd"),t&&a._alignSlides(r)})):o.stop().animate({left:-r},a.config.animationDuration,function(){e.data(a,"currentSlide",n),e.data(a,"isAnimating",!1),e.data(a,"justTouched",!1)})},_transition:function(t,a){var o,s,i,r,l,c;o=this,s=e(".slide-wrapper",o.$elem),(a===n||0>a)&&(a=1),i=o.data.browserEnginePrefix.css,r=i+"Transform",l=i+"TransitionDuration",c=i+"TransitionTimingFunction",s[0].style[l]=o.config.animationDuration*a+"ms",s[0].style[c]=o.config.animationTimingFunction,s[0].style[r]="translateX("+t+"px)",s.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",function(){e.data(o,"isAnimating",!1),e.data(o,"justTouched",!1),s.unbind("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd")})},_setActive:function(t,a){var n,o,s=this;n=s.config.activeSlideClass,t.removeClass(n),a.addClass(n),s.config.pagerNav&&(o=e("."+s.config.pagerClass,s.$elem),o.children().removeClass("act"),o.find("[rel="+a.index()+"]").addClass("act"))},_resize:function(){var t,a,n,o,s;t=this,t.data.isPlaying&&(e.data(t,"playPaused",!0),t.stop()),a=t.$elem.width(),n=t.config.height/t.config.width,o=a*n,e.data(t,"width",a),e(".slide",t.$elem).css({width:a,height:o}),s=e(".slide-wrapper",t.$elem).children().height(),e(".slide-wrapper",t.$elem).css({height:s}),e(".slide-container",t.$elem).css({width:a,height:s}),t.data.playPaused&&(e.data(t,"playPaused",!1),t.start()),t._prepareslides(),t.gotoSlide(t.data.currentSlide)},_getBrowserEnginePrefix:function(){var e,t,n;for(e="Transition",t=["Moz","Webkit","Khtml","O","ms"],n=0;n<t.length;){if("string"==typeof a.body.style[t[n]+e])return{css:t[n]};n++}return!1}},o.defaults=o.prototype.defaults,e.fn.excoloSlider=function(e){return this.each(function(){new o(this,e).init()})}}(jQuery,window,document),$(function(){$("#roller").excoloSlider({width:800,height:400,autoSize:!0,touchNav:!0,mouseNav:!0,prevnextNav:!1,prevnextAutoHide:!1,pagerNav:!1,startSlide:1,autoPlay:!1,delay:0,interval:3e3,repeat:!1,playReverse:!1,hoverPause:!0,captionAutoHide:!1,animationCssTransitions:!0,animationDuration:650,animationTimingFunction:"linear",activeSlideClass:"offer-active"})})}),$(function(){$(".show-settings").hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault();var t=$(this).data("show");$("#"+t).toggleClass("settings-shown"),$("i",this).toggleClass("fa-flip-vertical")}),$(function(){store.getItem("searchSettings").then(function(e){$("#search-radius").val(e[0].searchRadius),$('#travel-mode option[value="'+e[1].travelMode+'"]').attr("selected","selected"),$('#unit-system option[value="'+e[2].unitSystem+'"]').attr("selected","selected")}),$('[data-action="save-settings"]').hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),$("#search-settings").submit()}),$("#search-settings").submit(function(e){e.stopPropagation(),e.preventDefault(),searchRadius=$("#search-radius").val(),travelMode=$("#travel-mode").val(),unitSystem=$("#unit-system").val();var t=[{searchRadius:searchRadius},{travelMode:travelMode},{unitSystem:unitSystem}];store.setItem("searchSettings",t).then(function(){$("#search-settings").append('<p class="message success prominent timed">Settings have been saved.</p>'),setTimeout(function(){$(".timed").remove(),getSettings()},3500)})})}),$(function(){var e={setToken:function(e){localStorage.access_token=e.access_token,localStorage.refresh_token=e.refresh_token||localStorage.refresh_token;var t=(new Date).getTime()+1e3*parseInt(e.expires_in,10)-6e4;localStorage.expires_at=t},authorize:function(e){function t(t){var n="undefined"!=typeof t.url?t.url:t.originalEvent.url,s=/\?code=(.+)$/.exec(n),i=/\?error=(.+)$/.exec(n);(s||i)&&o.close(),s?$.post("https://accounts.google.com/o/oauth2/token",{code:s[1],client_id:e.client_id,client_secret:e.client_secret,redirect_uri:e.redirect_uri,grant_type:"authorization_code"}).done(function(e){googleapi.setToken(e),a.resolve(e)}).fail(function(e){a.reject(e.responseJSON)}):i&&a.reject({error:i[1]})}var a=$.Deferred(),n="https://accounts.google.com/o/oauth2/auth?"+$.param({client_id:e.client_id,redirect_uri:e.redirect_uri,response_type:"code",scope:e.scope}),o=window.open(n,"_blank","location=no,toolbar=no");
return o.addEventListener("loadstart",t),a.promise()},getToken:function(e){var t=$.Deferred();return(new Date).getTime()<localStorage.expires_at?t.resolve({access_token:localStorage.access_token}):localStorage.refresh_token?$.post("https://accounts.google.com/o/oauth2/token",{refresh_token:localStorage.refresh_token,client_id:e.client_id,client_secret:e.client_secret,grant_type:"refresh_token"}).done(function(e){googleapi.setToken(e),t.resolve(e)}).fail(function(e){t.reject(e.responseJSON)}):t.reject(),t.promise()},userInfo:function(e){return $.getJSON("https://www.googleapis.com/oauth2/v1/userinfo",e)}},t={client_id:"576726549275.apps.googleusercontent.com",client_secret:"7cELIkyAkF1a5ve-Z_6YoAhX",redirect_uri:"http://localhost",scope:"https://www.googleapis.com/auth/userinfo.profile",init:function(){$('[data-action="google-signin"]').hammer().on("tap",function(){t.LoginButton()}),e.getToken({client_id:app.client_id,client_secret:app.client_secret}).done(function(){t.showSuccessView()}).fail(function(){t.showLoginView()})},showLoginView:function(){$("#google-login").show(),$("#google-login-success").hide()},showSuccessView:function(){$("#google-login").hide(),$("#google-login-success").show(),e.getToken({client_id:t.client_id,client_secret:t.client_secret}).then(function(e){return googleapi.userInfo({access_token:e.access_token})}).done(function(e){$("#google-login-success p").html(e.name+" via Google")}).fail(function(){app.showLoginView()})},LoginButton:function(){e.authorize({client_id:t.client_id,client_secret:t.client_secret,redirect_uri:t.redirect_uri,scope:t.scope}).done(function(){t.showSuccessView()}).fail(function(e){$("#google-login p").html(e.error)})}};t.init()}),$(function(){store.getItem("userAccount").then(function(e){$("#username").val(e[0].userName),$("#useremail").val(e[1].userEmail),$("#userpassword").val(e[2].userPassword)}),$('[data-action="save-account"]').hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),$("#user-account").submit()}),$("#user-account").submit(function(e){e.stopPropagation(),e.preventDefault(),userName=$("#username").val(),userEmail=$("#useremail").val(),userPassword=$("#userpassword").val();var t=[{userName:userName},{userEmail:userEmail},{userPassword:userPassword}],a=$(this).serialize();return""==userName||""==userEmail||""==userPassword?($("#user-account").append('<p class="message warning prominent timed">All fields are required.</p>'),setTimeout(function(){$(".timed").remove()},3500),!1):userName.match(/[_\W0-9]/)?($("#user-account").append('<p class="message warning prominent timed">Please only use alphabetical characters in your username, no spaces or special characters.</p>'),setTimeout(function(){$(".timed").remove()},3500),!1):0!=userID?(console.log("creation failed"),$("#user-account").append('<p class="message warning prominent timed">You have already made an account.</p>'),setTimeout(function(){$(".timed").remove()},3500),!1):(store.setItem("userAccount",t).then(function(){store.getItem("userAccount").then(function(e){name=e[0].userName,console.log("name from store: "+name)}),$.ajax({type:"POST",data:a,url:serverURL+"register.php",async:!1,beforeSend:function(){console.log("creating"),$("#user-account").append('<p class="message success prominent creating">Creating...<br><i class="fa fa-2x fa-spinner fa-spin"></i></p>')},success:function(){$(".creating").remove(),$("#user-account").append('<p class="message success prominent timed">Your account has been registed and saved.</p>'),setTimeout(function(){$(".timed").remove()},3500)}})}),void 0)})}),$(function(){$('[data-action="submit-postcode-lookup"]').hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),$("#postcode-lookup").submit()}),$("#postcode-lookup").submit(function(e){return e.stopPropagation(),e.preventDefault(),""==$("#postcode").val()?($("#postcode").focus(),$("#postcode").attr("placeholder","No postcode entered")&&$("#postcode").addClass("plc-warning"),setTimeout(function(){$("#postcode").attr("placeholder","Enter a postcode")&&$("#postcode").removeClass("plc-warning")},2800),!1):(GMaps.geocode({address:$("#postcode").val().trim(),callback:function(e,t){if("OK"==t){var a=e[0].formatted_address;$(".geocode-result").text(a),$("#postcode").val("")}else $("#address").attr("placeholder","No results")&&$("#address").addClass("plc-warning"),setTimeout(function(){$("#address").attr("placeholder","Enter a postcode")&&$("#address").removeClass("plc-warning")},2800)}}),void 0)})}),$(function(){$('[data-action="send-feedback"]').hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),$("#send-feedback").submit()}),$("#send-feedback").submit(function(e){if(e.stopPropagation(),e.preventDefault(),""==$("#name").val()||""==$("#email").val()||""==$("#message").val())$("#send-feedback").append('<p class="message warning prominent timed">Please fill out all fields.</p>'),setTimeout(function(){$(".timed").remove()},3500);else{var t=$(this).serialize();$.ajax({type:"POST",data:t,url:serverURL+"feedback.php",beforeSend:function(){$("#send-feedback").append('<p class="message success prominent sending">Sending...<br><i class="fa fa-2x fa-spinner fa-spin"></i></p>')},success:function(){$(".sending").remove(),$("#send-feedback").append('<p class="message success prominent timed">Thanks for the feedback!</p>'),setTimeout(function(){$(".timed").remove(),$("#name").val("")&&$("#email").val("")&&$("#message").val("")},3500)}})}})}),$(function(){$("#confirm-delete").change(function(){var e=$(this);e.prop("checked")?$(".delete-button").css("display","block"):$(".delete-button").css("display","none")}).change(function(){$('[data-action="delete-data"]').hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),$("#confirm-delete").prop("checked")===!0&&(console.log("delete data button hit"),store.removeItem("searchSettings"),store.removeItem("userAccount"),$.ajax({type:"POST",data:{id:userID},url:serverURL+"deleteuser.php",async:!1,beforeSend:function(){$("#delete-data").append('<p class="message success prominent working">Working...<br><i class="fa fa-2x fa-spinner fa-spin"></i></p>')},success:function(){$(".working").remove(),$("#delete-data").append('<p class="message success prominent done">Your account and application data have been deleted, the app will now restart.</p>'),userID=0,setTimeout(function(){reloadApp()},4e3)},error:function(){console.log("Could not complete")}}))})})}),$('[data-get="settings"]').hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),getSettings()}),$('[data-user="userid"]').hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),getID()})}),$(function(){var e={prefetchLinks:function(){var e=$("a.prefetch").map(function(){return $(this).attr("href")});return $.unique(e)},addPrefetchTags:function(){this.prefetchLinks().each(function(e,t){$("<link />",{rel:"dns-prefetch",href:t}).appendTo("head")})}};$(function(){e.addPrefetchTags()})}),String.prototype.capitalise=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.hashCode=function(){var e,t,a,n=0;if(0==this.length)return n;for(e=0,a=this.length;a>e;e++)t=this.charCodeAt(e),n=(n<<5)-n+t,n|=0;return n};