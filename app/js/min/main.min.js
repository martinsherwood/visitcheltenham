function setStorage(){indexedDB||window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB;indexedDB?store.setDriver("IndexedDBWrapper").then(function(){console.log(store.driver+" IndexedDB")}):window.openDatabase?store.setDriver("WebSQLWrapper").then(function(){console.log(store.driver+" WebSQL")}):store.setDriver("localStorageWrapper").then(function(){console.log(store.driver+" LocalStorage")}),window.storeConfig={name:"visit_cheltenham_app",version:1,size:4980736,storeName:"vc_storage",description:"Config settings and other application data"}}function reloadApp(){location.reload(!0)}function getSettings(){store.getItem("searchSettings").then(function(e){searchRadius=parseInt(e[0].searchRadius),"walking"==e[1].travelMode?travelMode=google.maps.TravelMode.WALKING:"bicycling"==e[1].travelMode?travelMode=google.maps.TravelMode.BICYCLING:"driving"==e[1].travelMode&&(travelMode=google.maps.TravelMode.DRIVING),"imperial"==e[2].unitSystem?unitSystem=google.maps.UnitSystem.IMPERIAL:"metric"==e[2].unitSystem&&(unitSystem=google.maps.UnitSystem.METRIC)}),store.getItem("userName").then(function(e){userName=e})}function backButton(){console.log("backbutton"),navigator.notification.confirm("Exit?",function(e){1==e&&navigator.app.exitApp()},"Exit","Yes, No")}var app={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1),document.addEventListener("backbutton",backButton,!1)},onDeviceReady:function(){setStorage(),getSettings()},report:function(e){console.log("report:"+e)}},searchRadius,travelMode,unitSystem,userName,header='<header role="banner" data-role="header" class="app-header container inner-wrap"><div role="button" data-role="button" class="menu-stack push"></div><nav role="navigation" data-role="navbar" class="main-menu menu-closed"><div class="nav-links"><a data-goto="#home" data-push="page" data-get="settings"><i class="fa fa-border fa-home"></i>Home</a><a data-goto="#places" data-push="page"><i class="fa fa-border fa-location-arrow"></i>My Places</a><a data-goto="#offers" data-push="page"><i class="fa fa-border fa-shopping-cart"></i>Offers<span class="offer-count">0</span></a><a data-goto="#settings" data-push="page"><i class="fa fa-border fa-cog"></i>Settings</a></div></nav><div role="button" data-role="button" class="locate-button"></div></header>';$("body").prepend(header),$(function(){var e=$(".main-menu"),t=$("body"),o=$("#container"),a=$(".push"),n=$(".overlay"),s="menu-open",i="push-active",r="container-push",l="pushed",c=$(".menu-stack");app=$("#app"),handle="goto";var d=function(){t.toggleClass(i),e.toggleClass(s),o.toggleClass(r),a.toggleClass(l)};Modernizr.csstransforms3d&&(c.hammer().on("tap",function(){d()}),n.hammer().on("tap",function(){d()}),$("html").hammer().on("swipe",function(e){$(t).hasClass("push-active")||"right"!==e.gesture.direction?$(t).hasClass("push-active")&&"left"===e.gesture.direction&&(e.stopPropagation(),e.preventDefault(),d()):(e.stopPropagation(),e.preventDefault(),d())})),$currentPage=0===$("#app > .current").length?$("#app > *:first-child").addClass("current"):$("#app > .current"),$('[data-push="page"]').hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),d();var t=$(app).find(".current"),o=$(this).data(handle);$(t).removeClass("current"),$(o).addClass("current")}),$('[data-get="settings"]').hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),getSettings()})}),function(){var e,t,o,a,n,s=$(".results-names"),i=$(".results-details"),r=$(".results h1"),l=new google.maps.LatLng(51.902707,-2.073361),c=[{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"transit",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#a2daf2"}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{color:"#f7f1df"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#d0e3b4"}]},{featureType:"landscape.natural.terrain",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#bde6ab"}]},{featureType:"poi.medical",elementType:"geometry",stylers:[{color:"#fbd3da"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffe15f"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#efd151"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{color:"black"}]},{featureType:"transit.station.airport",elementType:"geometry.fill",stylers:[{color:"#cfb2db"}]}];getSettings(),$(function(){Modernizr.geolocation?GMaps.geolocate({success:function(e){var e={lat:e.coords.latitude,lng:e.coords.longitude};a=new google.maps.LatLng(e.lat,e.lng)},error:function(e){$(".location-map").append('<p class="no-geo message warning">Sorry, we failed to get your current location.</p>'),console.log(e.message)}}):noGeo()}),$(function(){function d(){Modernizr.geolocation?GMaps.geolocate({success:function(n){var n={lat:n.coords.latitude,lng:n.coords.longitude};a=new google.maps.LatLng(n.lat,n.lng),console.log("locate button, currentLocation: "+a),g(),t&&e&&(t.setMap(null),e.setMap(null)),o.addMarker({lat:n.lat,lng:n.lng,icon:"img/location-marker-blue.png",animation:google.maps.Animation.DROP}),o.setCenter(n.lat,n.lng),o.setZoom(16),$(".no-results").remove()},error:function(e){p(),console.log("Geolocation failed: "+e.message)}}):(u(),console.log("This browser/device does not support geolocation"))}function p(){$(".location-map").append('<p class="no-geo message warning">Sorry, this feature isn\'t available right now.</p>'),setTimeout(function(){$(".no-geo").remove()},3500)}function u(){$(".location-map").append('<p class="no-geo message warning">Sorry, this feature isn\'t supported on your device.</p>')}function g(){o.removeMarkers()}function m(){s.html(""),i.html(""),g(),$(".no-results").remove(),o.setZoom(14),t&&e&&(t.setMap(null),e.setMap(null))}return Modernizr.geolocation?(o=new GMaps({div:"#map-container",center:l,zoom:14,disableDefaultUI:!0,styles:c}),$(".locate-button").hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),Modernizr.geolocation?d():p()}),$('[data-action="submit-place-search"]').hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),$("#place-search").submit()}),$("#place-search").submit(function(c){c.stopPropagation(),c.preventDefault();var d=$("#place-query").val();return""==d?($("#place-query").focus(),$("#place-query").attr("placeholder","You didn't enter any terms")&&$("#place-query").addClass("plc-warning"),setTimeout(function(){$("#place-query").attr("placeholder","Search for places")&&$("#place-query").removeClass("plc-warning")},2800),!1):(o.addLayer("places",{location:l,radius:searchRadius,query:d,sensor:!0,language:"en-GB",textSearch:function(c,d){function p(e,t){if(t!=google.maps.DistanceMatrixStatus.OK)return!1;for(var o=e.originAddresses,a=e.destinationAddresses,n=0;n<o.length;n++)for(var s=e.rows[n].elements,r=0;r<s.length;r++){{var l=s[r],c=l.distance.text,d=l.duration.text;o[n],a[r]}i.append('<li data-animate="place-details" data-distance="'+c+'"data-duration="'+d+'">'+c+"</li>")}}if(d==google.maps.places.PlacesServiceStatus.OK){m();for(var u=new google.maps.LatLngBounds,g=0;g<c.length;g++){var f=c[g],h={url:f.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(20,20)};s.append('<li data-animate="place-name" data-placename="'+f.name+'"><span class="placename">'+f.name+'</span><div class="options"><div class="opt"><div data-destination="'+f.formatted_address+'" id="get-directions" class="directions-button"></div></div><div class="opt"><div data-placename="'+f.name+'" id="add-place" class="favourite-button"></div></div></div></li>'),n=a;var v=f.geometry.location,$=new google.maps.DistanceMatrixService;$.getDistanceMatrix({origins:[n],destinations:[v],travelMode:travelMode,unitSystem:unitSystem,avoidHighways:!1,avoidTolls:!1},p),o.addMarker({lat:f.geometry.location.lat(),lng:f.geometry.location.lng(),icon:h,animation:google.maps.Animation.DROP,title:f.name,infoWindow:{content:'<h2 class="iw-heading">'+f.name+'</h2><p class="iw-address">'+(f.vicinity?f.vicinity:f.formatted_address)+"</p>"}}),u.extend(f.geometry.location)}o.fitBounds(u),e=o.drawCircle({center:l,radius:4,strokeColor:"#00adef",strokeOpacity:1,strokeWeight:8,fillColor:"#00adef",fillOpacity:1}),t=o.drawCircle({center:l,radius:searchRadius,strokeColor:"#00adef",strokeOpacity:1,strokeWeight:1,fillColor:"#808080",fillOpacity:.28})}else d==google.maps.places.PlacesServiceStatus.ZERO_RESULTS?(console.log(d),m(),r.after('<p class="warning no-results">Sorry, no places were found matching your search.</p>')):d==google.maps.places.PlacesServiceStatus.INVALID_REQUEST&&console.log(d)}}),i.hammer().on("tap","li",function(e){e.stopPropagation(),e.preventDefault();var t=$(this),o=$(this).data("distance"),a=$(this).data("duration");t.text()==o?t.text(a):t.text(o)}),google.maps.event.addListener(o,"bounds_changed",function(){var e=o.getBounds();$("#place-query").setBounds(e)}),void 0)}),void 0):(u(),!1)}),$(function(){var e,t,o='<div id="directions-box"><h1 class="inner-wrap" data-transition="slide-down-in">Directions<i class="fa fa-times close-directions"></i></h1><div id="directions-list"></div></div>';$(".results-names").hammer().on("swipeleft tap","li",function(e){e.stopPropagation(),e.preventDefault(),$(this).children("span").toggleClass("swiped"),$(this).children("div").toggleClass("shown")}),$(".results-names").hammer().on("tap","#add-place",function(t){t.stopPropagation(),t.preventDefault(),e=$(this).data("placename"),console.log(e)}),$(".results-names").hammer().on("tap","#get-directions",function(e){e.stopPropagation(),e.preventDefault(),$("#home").removeClass("current"),$("body").prepend(o),t=$(this).data("destination");var n=document.getElementById("directions-list"),s=new google.maps.DirectionsService,i=new google.maps.DirectionsRenderer;i.setPanel(n),s.route({origin:a,destination:t,travelMode:travelMode,unitSystem:unitSystem},function(e,t){t===google.maps.DirectionsStatus.OK&&i.setDirections(e)}),$(".close-directions").hammer().on("tap",function(){$("#directions-box").remove(),$("#home").addClass("current")})})})}(),$(function(){$(function(){store.getItem("searchSettings").then(function(e){$("#search-radius").val(e[0].searchRadius),$('#travel-mode option[value="'+e[1].travelMode+'"]').attr("selected","selected"),$('#unit-system option[value="'+e[2].unitSystem+'"]').attr("selected","selected")}),$('[data-action="save-settings"]').hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault();var t=$("#search-radius").val(),o=$("#travel-mode").val(),a=$("#unit-system").val(),n=[{searchRadius:t},{travelMode:o},{unitSystem:a}];store.setItem("searchSettings",n).then(function(){$("#search-settings").append('<p class="message success prominent timed">Settings have been saved.</p>'),setTimeout(function(){$(".timed").remove(),getSettings()},3500)})})}),$(function(){var e={setToken:function(e){localStorage.access_token=e.access_token,localStorage.refresh_token=e.refresh_token||localStorage.refresh_token;var t=(new Date).getTime()+1e3*parseInt(e.expires_in,10)-6e4;localStorage.expires_at=t},authorize:function(e){function t(t){var a="undefined"!=typeof t.url?t.url:t.originalEvent.url,s=/\?code=(.+)$/.exec(a),i=/\?error=(.+)$/.exec(a);(s||i)&&n.close(),s?$.post("https://accounts.google.com/o/oauth2/token",{code:s[1],client_id:e.client_id,client_secret:e.client_secret,redirect_uri:e.redirect_uri,grant_type:"authorization_code"}).done(function(e){googleapi.setToken(e),o.resolve(e)}).fail(function(e){o.reject(e.responseJSON)}):i&&o.reject({error:i[1]})}var o=$.Deferred(),a="https://accounts.google.com/o/oauth2/auth?"+$.param({client_id:e.client_id,redirect_uri:e.redirect_uri,response_type:"code",scope:e.scope}),n=window.open(a,"_blank","location=no,toolbar=no");return n.addEventListener("loadstart",t),o.promise()},getToken:function(e){var t=$.Deferred();return(new Date).getTime()<localStorage.expires_at?t.resolve({access_token:localStorage.access_token}):localStorage.refresh_token?$.post("https://accounts.google.com/o/oauth2/token",{refresh_token:localStorage.refresh_token,client_id:e.client_id,client_secret:e.client_secret,grant_type:"refresh_token"}).done(function(e){googleapi.setToken(e),t.resolve(e)}).fail(function(e){t.reject(e.responseJSON)}):t.reject(),t.promise()},userInfo:function(e){return $.getJSON("https://www.googleapis.com/oauth2/v1/userinfo",e)}},t={client_id:"576726549275.apps.googleusercontent.com",client_secret:"7cELIkyAkF1a5ve-Z_6YoAhX",redirect_uri:"http://localhost",scope:"https://www.googleapis.com/auth/userinfo.profile",init:function(){$('[data-action="google-signin"]').hammer().on("tap",function(){t.LoginButton()}),e.getToken({client_id:app.client_id,client_secret:app.client_secret}).done(function(){t.showSuccessView()}).fail(function(){t.showLoginView()})},showLoginView:function(){$("#google-login").show(),$("#google-login-success").hide()},showSuccessView:function(){$("#google-login").hide(),$("#google-login-success").show(),e.getToken({client_id:t.client_id,client_secret:t.client_secret}).then(function(e){return googleapi.userInfo({access_token:e.access_token})}).done(function(e){$("#google-login-success p").html(e.name+" via Google")}).fail(function(){app.showLoginView()})},LoginButton:function(){e.authorize({client_id:t.client_id,client_secret:t.client_secret,redirect_uri:t.redirect_uri,scope:t.scope}).done(function(){t.showSuccessView()}).fail(function(e){$("#google-login p").html(e.error)})}};t.init()}),$(function(){store.getItem("userName").then(function(e){$("#username").val(e)}),$('[data-action="save-username"]').hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),$("#user").submit()}),$("#user").submit(function(e){e.stopPropagation(),e.preventDefault();var t=$("#username").val();return""==t?($("#username").attr("placeholder","No username entered")&&$("#username").addClass("plc-warning"),setTimeout(function(){$("#username").attr("placeholder","Enter a username")&&$("#username").removeClass("plc-warning")},2800),!1):(store.setItem("userName",t).then(function(){$("#user").append('<p class="message success prominent timed">Username has been saved.</p>'),setTimeout(function(){$(".timed").remove(),$("#username").val(t),getSettings()},3500)}),void 0)})}),$(function(){$('[data-action="submit-geocode-search"]').hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),$("#geocode-search").submit()}),$("#geocode-search").submit(function(e){return e.stopPropagation(),e.preventDefault(),""==$("#postcode").val()?($("#postcode").focus(),$("#postcode").attr("placeholder","No postcode entered")&&$("#postcode").addClass("plc-warning"),setTimeout(function(){$("#postcode").attr("placeholder","Enter a postcode")&&$("#postcode").removeClass("plc-warning")},2800),!1):(GMaps.geocode({address:$("#postcode").val().trim(),callback:function(e,t){if("OK"==t){var o=e[0].formatted_address;$(".geocode-result").text(o),$("#postcode").val("")}else $("#address").attr("placeholder","No results")&&$("#address").addClass("plc-warning"),setTimeout(function(){$("#address").attr("placeholder","Enter a postcode")&&$("#address").removeClass("plc-warning")},2800)}}),void 0)})}),$(function(){$('[data-action="send-feedback"]').hammer().on("tap",function(e){e.stopPropagation(),e.preventDefault(),$("#send-feedback").submit()}),$("#send-feedback").submit(function(e){if(e.stopPropagation(),e.preventDefault(),""==$("#name").val()||""==$("#email").val()||""==$("#message").val())$("#send-feedback").append('<p class="message warning prominent timed">Please fill out all fields.</p>'),setTimeout(function(){$(".timed").remove()},3500);else{var t=$(this).serialize();$.ajax({type:"POST",data:t,url:"http://martinsherwood.co.uk/visitcheltenham/feedback.php",beforeSend:function(){$("#send-feedback").append('<p class="message success prominent sending">Sending...<br><i class="fa fa-2x fa-spinner fa-spin"></i></p>')},success:function(){$(".sending").remove(),$("#send-feedback").append('<p class="message success prominent timed">Thanks for the feedback!</p>'),setTimeout(function(){$(".timed").remove(),$("#name").val("")&&$("#email").val("")&&$("#message").val("")},3500)}})}})})}),$(function(){}),$(function(){var e={prefetchLinks:function(){var e=$("a.prefetch").map(function(){return $(this).attr("href")});return $.unique(e)},addPrefetchTags:function(){this.prefetchLinks().each(function(e,t){$("<link />",{rel:"dns-prefetch",href:t}).appendTo("head")})}};$(function(){e.addPrefetchTags()})}),String.prototype.capitalise=function(){return this.charAt(0).toUpperCase()+this.slice(1)};
//# sourceMappingURL=main.min.js.map